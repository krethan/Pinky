<!doctype html>
<html>
	<head>
		<meta charset='utf-8'>
		<meta http-equiv="X-UA-Compatible" content="chrome=1">
		<link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
		<link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
		
		<!-- Google Code Prettify -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r224/prettify.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r224/prettify.css">
		<link rel="stylesheet" type="text/css" href="stylesheets/prettify.css" media="screen">

		<!--[if lt IE 9]>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<title>Pinky</title>
	</head>

	<body onload="prettyPrint()">
		<div id="container">
			<div class="inner">

				<header>
					<img src="images/pinky_logo_small.png" alt="Pinky logo">
					<h1>Pinky</h1>
					<h2>A straight-forward Promises/A+ 1.1 implementation</h2>
				</header>

				<section id="downloads" class="buttonGroup">
					<a href="/build/Pinky.js" id="download-js" class="button" download><span>Download .js</span></a>
					<a href="https://github.com/lazd/Pinky" id="view-on-github" class="button"><span>View on GitHub</span></a>
				</section>

				<hr>

				<section id="main_content">
					<h1>Pinky</h1>

<p>Pinky is a no-nonsense <a href="http://promises-aplus.github.com/promises-spec/">Promises/A+</a> implementation. Pinky is written to be very readable and easy to follow, with references to the relevant sections of the spec for each operation. As such, Pinky can be used as an academic example of a promises implementation.</p>

<p>Pinky includes a number of fully documented examples that illustrate common use cases, explain exactly what's going on, and highlight the power of promises. Several included examples can be used as independent explanations of the functionality promises can provide without any prior introduction to the concept.</p>

<h1>API</h1>

<p>Create a new Pinky instance with <code>var pinky = new Pinky()</code>.</p>

<h2>Methods</h2>

<p><strong>pinky.fulfill(</strong> <em>value</em> <strong>)</strong></p>

<p>When passed a value, the promise will be fulfilled. All onFulfilled callbacks will receive the passed value as their first argument.</p>

<p><strong>pinky.reject(</strong> <em>reason</em> <strong>)</strong></p>

<p>When passed a reason, the promise will be rejected. All onRejected callbacks will receive the passed error as their first argument.</p>
<p><code>pinky.resolve</code> is aliased to this method.</p>

<p><strong>pinky.then(</strong> <em>onFulfilled</em>, <em>onRejected</em> <strong>)</strong></p>

<p>Used to add onFulfilled and onRejected callbacks to the promise. The same method is provided as <code>pinky.promise.then(...)</code>.</p>

<h2>Properties</h2>

<p><strong>pinky.promise</strong></p>

<p>The <code>pinky.promise</code> property is a "thenable" object that should be returned by functions that use Pinky. Instead of returning the Pinky instance itself, which would allow callers to fulfill/reject the promise, your function should <code>return pinky.promise</code> -- an object that includes the one method a promise must have: <code>pinky.then(...)</code>.</p>

<h1>Usage</h1>

<p>Pinky can be used both on the server and the client.</p>

<h2>Node.js</h2>

<p>First, install the Pinky module using <code>npm</code>. Optionally use <code>--save</code> to save Pinky as a dependency in your <code>package.json</code>:</p>

<pre class="prettyprint">
npm install pinkypromise --save
</pre>

<p>Next, require Pinky:</p>

<pre class="prettyprint">
var pinky = require('pinky');
</pre>

<p>Then, use promises in your code:</p>

<pre class="prettyprint">
function helloWorld() {
  var pinky = new Pinky();

  pinky.fulfill('world');

  return pinky.promise;
}

helloWorld().then(function(value) {
  console.log('Hello '+value);
});
</pre>

<h2>Browser</h2>

<p>Just include <a href="/build/Pinky.js"><code>pinky.js</code></a> on your page:</p>

<h2>AMD module</h2>

<p>Pinky can also be used as an AMD module.</p>

<h1>Examples</h1>

See Pinky in action, try one of these examples in your browser:
<section class="buttonGroup">
	<a href="build/examples/browser/fetchJSON.html" class="button">Fetch &amp; Parse JSON</a>
	<a href="build/examples/browser/getRandom.html" class="button">Fetch &amp; Validate Data</a>
</section>

<h3>A complete example: fetching a value and handling errors</h3>

<p>The example below simulates an asynchronous fetch of a random value with error handling and validation.</p>

<p>This example has the following possible outcomes:</p>

<ol>
<li>
<strong>Fulfilled</strong>: The fetched value is valid.</li>
<li>
<strong>Rejected</strong>: The fetch timed out and the generated backup value is invalid.</li>
<li>
<strong>Fulfilled</strong>: The fetch timed out or the fetched value is invalid, but the generated value is valid.</li>
<li>
<strong>Rejected</strong>: The fetch timed out or the fetched value is invalid, and generated value is invalid.</li>
</ol><h3>fetchRandom(): a function that returns a promise</h3>

<p>The <code>fetchRandom()</code> function simulates an asynchronous fetch and returns a promise that:</p>

<ul>
<li>Will be rejected if the "request" times out</li>
<li>Will be fulfilled with the "response" if it comes back in time</li>
</ul>

<pre class="prettyprint">
/**
  Simulate fetching a random number from a remote source
  Time out if the pretend remote source responds too slowly
*/
function fetchRandom() {
  // Create a Pinky instance
  var pinky = new Pinky();

  // Let's pretend we're fetching the random number from a remote source
  // Randomly choose a "response time" between 0 and 100 milliseconds
  var responseTime = Math.random()*100;

  // We'll timeout if the source takes too long and reject the promise
  var timeoutTime = 50;
  var timeout = setTimeout(function() {
    pinky.reject(new Error('Request timed out'));
  }, timeoutTime);

  // Simulate an asynchronous fetch using setTimeout
  setTimeout(function() {
    // The response came back in time, clear our timeout
    clearTimeout(timeout);
  
    // Fulfill the promise with a random number when our pretend source responds
    pinky.fulfill(Math.random());
  }, responseTime);

  // Return the promise, which has a single method: then()
  return pinky.promise;
}
</pre>

<h3>How to <em>then()</em>: using the promise returned by fetchRandom()</h3>

<p><code>fetchRandom()</code> is called and 3 chained <code>then()</code> calls are made, each of which returns a new promise:</p>

<ol>
<li>With the first call to <code>then()</code> (on the promise returned by <code>fetchRandom()</code>), we'll pass the fulfillment value on if it's "valid" (not greater than 0.5), or let the timeout exception bubble to the next promise's onRejected handler.</li>
<li>With the second <code>then()</code> call (on the promise returned by the first <code>then()</code> call), we'll let the fulfillment value bubble to the next promise's onFulfilled handler, or we'll handle invalid value exception by attempting to generate a valid value locally, returning it if we're successful, or throwing another exception if we're not.</li>
<li>With the third <code>then()</code> call (on the promise returned by the second <code>then()</code> call), we'll print the fulfillment value and its source, or we'll print an error indicating we were unable to get a valid value.</li>
</ol>

<pre class="prettyprint">
// A value is "valid" if it is not greater than 0.5
function isValid(value) { return !(value > 0.5); }

// Call our asynchronous random number fetcher
fetchRandom().then(
  function(value) {// onFulfilled handler
    // If the value is valid, return it to fulfill the next promise
    // Or, if the value isn't valid, we'll reject the next promise by throwing an error
    if (!isValid(value)) {
      // Reject the next promise by throwing because the random number is too big
      var reason = new Error('Fetched value is invalid');
      reason.value = value;
      throw reason;
    }
  
    // Fulfill the next promise by returning if the value is small enough
    return {
      method: 'fetched',
      value: value
    };
  },
  null // Let the rejection reason bubble to the next promise's onRejected handler
)
.then(
  null, // Let the fulfillment value bubble to the next promise's onFulfilled handler

  function(reason) { // onRejected handler
    // If we return a value, the next promise will be fulfilled
    // Or, if we throw/re-throw, the next promise will be rejected
  
    // Fall back to generating a random number locally
    var newValue = Math.random();
    if (isValid(newValue)) {
      // Fulfill the next promise if our locally generated value is valid
      return {
        method: 'generated', 
        value: newValue
      };
    }
  
    // Throw a new error, including the message from the previously thrown error
    var newReason = new Error(reason.message+' and generated value is invalid');
    newReason.value = {
      fetched: reason.value,
      generated: newValue
    };
    throw newReason;
  }
)
.then(
  function(result) { // onFulfilled handler
    // Dump the value and how we got it
    console.log('Fulfilled: '+result.method+' value is valid: '+result.value, '\n');
  },
  function(reason) { // onRejected handler
    // Dump the reason the operation failed
    console.error('Rejected: '+reason, reason.value, '\n');
  }
);
</pre>

<h1>Testing</h1>

<p>Execute the following commands to run the <a href="https://github.com/promises-aplus/promises-tests">Promises/A+ test suite</a>:</p>

<pre class="prettyprint">
npm install
npm test
</pre>

<h1>License</h1>

<p><a href="https://github.com/lazd/Pinky/blob/master/LICENSE.md">BSD license</a>, Copyright &copy; 2014 Lawrence Davis</p>
				</section>

				<footer>
					Pinky is maintained by <a href="https://github.com/lazd">lazd</a>.
				</footer>

									<script type="text/javascript">
						var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
						document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
					</script>
					<script type="text/javascript">
						try {
							var pageTracker = _gat._getTracker("UA-37564953-1");
							pageTracker._trackPageview();
						} catch(err) {}
					</script>

			</div>
		</div>
	</body>
</html>
